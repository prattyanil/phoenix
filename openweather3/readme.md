
###### **_API Testing Scenario :_**

Project Snapshot :

Your new team has an upcoming need to implement API testing. They do not have prior experience in that field and have requested you to create a project
that will give them a template on how a proper testing solution should be setup and utilised. They intend to run the solution as part of continuous testing.
They have asked you to implement an API testing solution against an open API weather station available from the following URL. Please note that you will
to register with the website in order to utilise their API - https://openweathermap.org/stations.

Exercise
Using the API specification detailed in the URL above, develop the following tests:
1. Validate that attempt to register a weather station without an API key will return the following in message body.

{
 "code": 401,
 "message": "Invalid API key. Please see http://openweathermap.org/faq#error401 for more info."
}

2. Successfully register two stations with the following details and verify that HTTP response code is 201.

{
 "external_id": "DEMO_TEST001",
 "name": "Team Demo Test Station 001",
 "latitude": 33.33,
 "longitude": -122.43,
 "altitude": 222
}
{
 "external_id": "DEMO_TEST002",
 "name": "Team Demo Test Station 002",
 "latitude": 44.44,
 "longitude": -122.44,
 "altitude": 111
}

3. Using “[GET] /stations” API verify that the stations were successfully stored in the DB and their values are the same as specified in the
registration request.


**Solution Design and Framework Structure**

This Gradle project has been developed to address the above problem statement using Groovy , Geb Spock and Jgiven BDD framework

IDE Used : IntelliJ 

- All required gradle dependencies have been specified under build.gradle

- OpenWeatherTestPackage holds the main API Test class with individual tests

- The step definations have been defined under Steps

- Spock Framework has been used to achive Data driven test
  http://spockframework.org/spock/javadoc/1.0/spock/

- This gradle project can be integrated with any CI / CD Pipeline and can be run using Gradle command line commands

- Jgiven BDD Framework has been used to generate user friendly Json / HTML reports. JGiven generates scenario reports for business owners and domain experts
  JSON reports for the executed tests can be found under jgiven-reports
  HTML reports can be generated by adding a Gradle dependency and by running "$ gradle test jgivenTestReport"


##### **_Scope of Improvements :_**

- Building a centralized properties file for config and variable definations
- Cleanup functions for deleting test registrations from DB 
- Parametrization and optiization of the helper functions


##### **_Sample Run Results :_**

**BDD Report**

Test Class: au.com.OpenWeatherTestPackage.OpenWeatherAPITest

 Open weather API Test 01 - invalid APPID

   Given I have sent a request to the openweather API
    When I POST a JSON Request with {external_id=DEMO_Test, name=Station Registration key test, latitude=22.22, longitude=-122.42, altitude=333}
     And I print the JSON Response
    When get response
    When get response
    Then The Assertion Should Pass 401
    Then The Assertion Should Pass Invalid API key. Please see http://openweathermap.org/faq#error401 for more info.


 Open weather API Test 02 - New Station Registration

   Given I have sent a request to the openweather API
    When I POST a JSON Request with <payload>
     And I print the JSON Response
    When get response
    When get response

  Cases:

   | # | payload                                                                                                      | Status  |
   +---+--------------------------------------------------------------------------------------------------------------+---------+
   | 1 | {external_id=DEMO_TEST001, name=Team Demo Test Station 001, latitude=33.33, longitude=-122.43, altitude=222} | Success |
   | 2 | {external_id=DEMO_TEST002, name=Team Demo Test Station 002, latitude=44.44, longitude=-122.44, altitude=111} | Success |


 Open weather API Test 03 -Fetch Registered Stations

   Given I have sent a request to the openweather API
    When I send a GET Request with
     And I print the JSON Response
    When get response
    When get response
    When get response
    When get response
    When get response
    Then The Assertion Should Pass <response>
    Then The Assertion Should Pass <response2>
    Then The Assertion Should Pass <response3>
    Then The Assertion Should Pass <response4>
    Then The Assertion Should Pass <response5>

  Cases:

   | # | response     | response2                  | response3 | response4 | response5 | Status  |
   +---+--------------+----------------------------+-----------+-----------+-----------+---------+
   | 1 | DEMO_TEST001 | Team Demo Test Station 001 |     33.33 |   -122.43 |       222 | Success |
   | 2 | DEMO_TEST002 | Team Demo Test Station 002 |     44.44 |   -122.44 |       111 | Success |


Process finished with exit code 0

**Detailed Report:**

SLF4J: Actual binding is of type [org.slf4j.impl.SimpleLoggerFactory]
Request method:	POST
Request URI:	http://api.openweathermap.org/data/3.0/stations
Proxy:			<none>
Request params:	<none>
Query params:	<none>
Form params:	<none>
Path params:	<none>
Multiparts:		<none>
Headers:		Accept=*/*
				Content-Type=application/json; charset=UTF-8
Cookies:		<none>
Body:
{
    "external_id": "DEMO_Test",
    "name": "Station Registration key test",
    "latitude": 22.22,
    "longitude": -122.42,
    "altitude": 333
}
{
    "cod": 401,
    "message": "Invalid API key. Please see http://openweathermap.org/faq#error401 for more info."
}
Request method:	POST
Request URI:	http://api.openweathermap.org/data/3.0/stations?APPID=446653a2d7058513f24b4a74fc95660f
Proxy:			<none>
Request params:	<none>
Query params:	<none>
Form params:	<none>
Path params:	<none>
Multiparts:		<none>
Headers:		Accept=*/*
				Content-Type=application/json; charset=UTF-8
Cookies:		<none>
Body:
{
    "external_id": "DEMO_TEST001",
    "name": "Team Demo Test Station 001",
    "latitude": 33.33,
    "longitude": -122.43,
    "altitude": 222
}
{
    "ID": "5dafc6046c634e000115a23d",
    "updated_at": "2019-10-23T03:16:20.099858326Z",
    "created_at": "2019-10-23T03:16:20.099858284Z",
    "user_id": "5dad231b9d0c9100073d93f6",
    "external_id": "DEMO_TEST001",
    "name": "Team Demo Test Station 001",
    "latitude": 33.33,
    "longitude": -122.43,
    "altitude": 222,
    "rank": 10,
    "source_type": 5
}
Request method:	POST
Request URI:	http://api.openweathermap.org/data/3.0/stations?APPID=446653a2d7058513f24b4a74fc95660f
Proxy:			<none>
Request params:	<none>
Query params:	<none>
Form params:	<none>
Path params:	<none>
Multiparts:		<none>
Headers:		Accept=*/*
				Content-Type=application/json; charset=UTF-8
Cookies:		<none>
Body:
{
    "external_id": "DEMO_TEST002",
    "name": "Team Demo Test Station 002",
    "latitude": 44.44,
    "longitude": -122.44,
    "altitude": 111
}
{
    "ID": "5dafc6046c634e000115a23e",
    "updated_at": "2019-10-23T03:16:20.764779281Z",
    "created_at": "2019-10-23T03:16:20.764779238Z",
    "user_id": "5dad231b9d0c9100073d93f6",
    "external_id": "DEMO_TEST002",
    "name": "Team Demo Test Station 002",
    "latitude": 44.44,
    "longitude": -122.44,
    "altitude": 111,
    "rank": 10,
    "source_type": 5
}
Request method:	GET
Request URI:	http://api.openweathermap.org/data/3.0/stations/5dafc6046c634e000115a23d?APPID=446653a2d7058513f24b4a74fc95660f
Proxy:			<none>
Request params:	<none>
Query params:	<none>
Form params:	<none>
Path params:	<none>
Multiparts:		<none>
Headers:		Accept=*/*
				Content-Type=application/json; charset=UTF-8
Cookies:		<none>
Body:			<none>
{
    "id": "5dafc6046c634e000115a23d",
    "created_at": "2019-10-23T03:16:20.099Z",
    "updated_at": "2019-10-23T03:16:20.099Z",
    "external_id": "DEMO_TEST001",
    "name": "Team Demo Test Station 001",
    "longitude": -122.43,
    "latitude": 33.33,
    "altitude": 222,
    "rank": 10
}
Request method:	GET
Request URI:	http://api.openweathermap.org/data/3.0/stations/5dafc6046c634e000115a23e?APPID=446653a2d7058513f24b4a74fc95660f
Proxy:			<none>
Request params:	<none>
Query params:	<none>
Form params:	<none>
Path params:	<none>
Multiparts:		<none>
Headers:		Accept=*/*
				Content-Type=application/json; charset=UTF-8
Cookies:		<none>
Body:			<none>
{
    "id": "5dafc6046c634e000115a23e",
    "created_at": "2019-10-23T03:16:20.764Z",
    "updated_at": "2019-10-23T03:16:20.764Z",
    "external_id": "DEMO_TEST002",
    "name": "Team Demo Test Station 002",
    "longitude": -122.44,
    "latitude": 44.44,
    "altitude": 111,
    "rank": 10
}


